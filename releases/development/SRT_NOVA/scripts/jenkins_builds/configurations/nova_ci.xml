<?xml version='1.0' encoding='UTF-8'?>
<matrix-project plugin="matrix-project@1.6">
  <actions/>
  <description>Multiplatform Continuous Integration for NOvA</description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <jenkins.model.BuildDiscarderProperty>
      <strategy class="hudson.tasks.LogRotator">
        <daysToKeep>30</daysToKeep>
        <numToKeep>-1</numToKeep>
        <artifactDaysToKeep>-1</artifactDaysToKeep>
        <artifactNumToKeep>-1</artifactNumToKeep>
      </strategy>
    </jenkins.model.BuildDiscarderProperty>
    <com.sonyericsson.rebuild.RebuildSettings plugin="rebuild@1.25">
      <autoRebuild>false</autoRebuild>
      <rebuildDisabled>false</rebuildDisabled>
    </com.sonyericsson.rebuild.RebuildSettings>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.PasswordParameterDefinition>
          <name>NOVA_CREDENTIAL</name>
          <description>PEM format dump of proxy, escaped for web parameters.   
To pass with curl, use 
  --data-urlencode &quot;NOVA_CREDENTIAL@$X509_USER_PROXY&quot; 
or
  --data-urlenclde &quot;NOVA_CREDENTIAL@/tmp/x509up_u`id -u`&quot;
</description>
          <defaultValue>g5fbDqN3Xdbq6VDvKUXyAAR43QHCPnVpFtNhDrvCazk=</defaultValue>
        </hudson.model.PasswordParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>NOVA_DEBUG</name>
          <description>Turn on more verbosity in builds.  To pass with curl, use
  --data NOVA_DEBUG=true</description>
          <defaultValue>false</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>NOVA_REVISION</name>
          <description>Allows you to specify exactly which modules you want to be built. The syntax for this parameter is a comma-separated list of terms. The syntax for each term is as follows.

Syntax for each term:
[module]@[location]

*** THE SECTION BELOW NEEDS TO BE UPDATED ***
Valid syntax types for [modules]@:
Replace [module] with the name of a novasoft module to specify that module. (e.g.
 novaFOO@[location])
Replace [module] with * to specify all modules. (i.e. *@[location])
Leave out [module]@. If no at sign is detected, *@ will be appended and all modu
les will be drawn from [location]. (i.e. [location])

Valid syntax types for [location]:
Replace [location] with a branch of the NOvA repository to specify that [modu
le] will be drawn from that branch. (e.g. [module]@develop)
Replace [location] with ~ to specify that [module] will be drawn from the versio
n specified in NOVA_VERSION. (i.e. [module]@~)
Leave out [location]. If nothing is detected after the [module]@, develop will b
e appended and the modules will be drawn from the develop branch. (i.e. [module]
@)
</description>
          <defaultValue>*@develop</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>NOVA_TESTS</name>
          <description>Name(s) of test suites for the post-install test_runner to run.</description>
          <defaultValue>default</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>NOVA_CI_VERSION</name>
          <description>Version of nova_ci package to checkout from repository to start the build/tests</description>
          <defaultValue>v0_6_0</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>NOVA_WFCFG</name>
          <description>Workflow config file to use when running workflow.sh</description>
          <defaultValue>cfg/workflow.cfg</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>TRIGGER_REASON</name>
          <description>How this build got started.</description>
          <defaultValue>Launched from https://buildmaster.fnal.gov</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>COPY_TEST_OUTPUT</name>
          <description>set to &quot;true&quot; to tell test_runner to copy reference test data out</description>
          <defaultValue>false</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>CET_TEST_GROUPS</name>
          <description>test set to run with during the make-test / mrb test phase.</description>
          <defaultValue>ALL</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>NOVA_QUALS</name>
          <description>qualifier to use for novasoft code</description>
          <defaultValue>e9:s28:grid:prof</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>NOVA_VERSION</name>
          <description>version to use for novasoft code</description>
          <defaultValue>develop</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>NOVA_WORKFLOW</name>
          <description></description>
          <defaultValue>mrb</defaultValue>
        </hudson.model.StringParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
    <hudson.plugins.throttleconcurrents.ThrottleJobProperty plugin="throttle-concurrents@1.8.4">
      <maxConcurrentPerNode>1</maxConcurrentPerNode>
      <maxConcurrentTotal>4</maxConcurrentTotal>
      <throttleEnabled>true</throttleEnabled>
      <throttleOption>project</throttleOption>
      <matrixOptions>
        <throttleMatrixBuilds>true</throttleMatrixBuilds>
        <throttleMatrixConfigurations>true</throttleMatrixConfigurations>
      </matrixOptions>
    </hudson.plugins.throttleconcurrents.ThrottleJobProperty>
  </properties>
  <scm class="hudson.scm.NullSCM"/>
  <assignedNode>master</assignedNode>
  <canRoam>false</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <authToken>please</authToken>
  <triggers/>
  <concurrentBuild>true</concurrentBuild>
  <axes>
    <hudson.matrix.LabelExpAxis>
      <name>label_exp</name>
      <values>
        <string>SLF6</string>
      </values>
    </hudson.matrix.LabelExpAxis>
    <hudson.matrix.LabelExpAxis>
      <name>label_exp2</name>
      <values>
        <string>swarm</string>
      </values>
    </hudson.matrix.LabelExpAxis>
  </axes>
  <builders>
    <hudson.tasks.Shell>
      <command>export PRODUCTS=/grid/fermiapp/products/common/db

setup () 
{ 
    . `/grid/fermiapp/products/common/db/../prd/ups/v5_1_4/Linux64bit-2-6-2-12/bin/ups setup &quot;$@&quot;`
}

# fetch generic_ci and nova_ci from git, and set it up
#=======================================
rm -rf generic_ci nova_ci

git clone http://cdcvs.fnal.gov/projects/generic_ci
svn checkout http://cdcvs.fnal.gov/subversion/novaart.pkgs.svn/trunk/nova_ci

cd generic_ci
git checkout ${NOVA_CI_VERSION:-v0_6_0}
export GENERIC_CI_DIR=`pwd`
export PATH=$GENERIC_CI_DIR/bin:$PATH
setup -. generic_ci

cd ../nova_ci
export NOVA_CI_DIR=`pwd`
setup -. -j nova_ci

cd ..
#========================
workflow.sh
</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers>
    <hudson.tasks.ArtifactArchiver>
      <artifacts>*/*.log,*.out,*.log,*.log.html,buildframe.html,*/histocmp.html,*/histocmp.html_files/*.gif,*.xml</artifacts>
      <allowEmptyArchive>false</allowEmptyArchive>
      <onlyIfSuccessful>false</onlyIfSuccessful>
      <fingerprint>false</fingerprint>
      <defaultExcludes>true</defaultExcludes>
      <caseSensitive>true</caseSensitive>
    </hudson.tasks.ArtifactArchiver>
  </publishers>
  <buildWrappers>
    <hudson.plugins.build__timeout.BuildTimeoutWrapper plugin="build-timeout@1.15.1">
      <strategy class="hudson.plugins.build_timeout.impl.NoActivityTimeOutStrategy">
        <timeoutSecondsString>1800</timeoutSecondsString>
      </strategy>
      <operationList>
        <hudson.plugins.build__timeout.operations.FailOperation/>
      </operationList>
    </hudson.plugins.build__timeout.BuildTimeoutWrapper>
  </buildWrappers>
  <executionStrategy class="hudson.matrix.DefaultMatrixExecutionStrategyImpl">
    <runSequentially>false</runSequentially>
  </executionStrategy>
</matrix-project>