Instructions for using layered releases in SRT.

1) What is a layered release?

A layered release contains links to other releases. The "other releases" are
called "sublayers." Sublayers solve the problem of a broken low-level package
breaking the entire build. See the example below.

Layering only applies to base releases.

2) Creating a layered release.

The lowest sublayer in a set of layered releases is an ordinary base release.
It must contain the SoftRelTools package. If there is an SRT_$SRT_PROJECT
package, it must also be in the lowest sublayer.

The remaining layers in a layered release are also created like ordinary base
releases. The following additional steps must be followed:
    1) Do not add the SoftRelTools or SRT_$SRT_PROJECT packages. They will be
    found in a sublayer. 
    2) Create a subdirectory called "sublayers" in the top of the base release.
    3) Within the sublayers directory, create links to the sublayer releases.
    4) Execute srt_layer_init, which will create links to the SoftRelTools and
    SRT_$SRT_PROJECT packages.
The release can now be built like any other release.

3) Detailed example

In the following example, I will create a set of layered releases with the
structure:

        layer2
layer1a       layer1b
        layer0

layer0 is the lowest subrelease. It is completely self-contained. layer1a and
layer1b depend on layer0, but not on each other. layer2 depends on layer1a,
layer1b and layer0.

Here goes:

*** Create layer0 ***
|abacus>pwd
/home/amundson/work/dist/releases
|abacus>newrel --empty -p layer0
Creating a frozen release "layer0" in the directory
    /home/amundson/work/dist/releases
|abacus>cd layer0
|abacus>srt_setup SRT_BASE_RELEASE=layer0
|abacus>addpkg --production --head SoftRelTools
Adding package "SoftRelTools" to "/home/amundson/work/dist/releases/layer0".
|abacus>addpkg --production --head SRT_ODS     
Adding package "SRT_ODS" to "/home/amundson/work/dist/releases/layer0".
|abacus>addpkg --production --head Hello  
Adding package "Hello" to "/home/amundson/work/dist/releases/layer0".
|abacus>gmake
<**codegen**>
<**codegen**> Hello
<**codegen**> SoftRelTools
<**include**>
<**include**> Hello
<**include**> SoftRelTools
<**lib**>
<**lib**> Hello
<**compiling**> Hello.cc
<**building library**> libHello
<**lib**> SoftRelTools
<**bin**>
<**bin**> Hello
<**compiling**> HelloExample.cc
<**building**> HelloExample
<**bin**> SoftRelTools
<**installing script**> addpkg
<**installing script**> cvsmigrate
<**installing script**> depend
<**installing script**> lnkpkg
<**installing script**> newdist
<**installing script**> newpkg
<**installing script**> newrel
<**installing script**> newver
<**installing script**> pkgstatus
<**installing script**> reldb
<**installing script**> relpathto
<**installing script**> rmpkg
<**installing script**> rmver
<**installing script**> srt_environment
<**installing script**> srt_freeze
<**installing script**> srt_int_drop
<**installing script**> srt_int_info
<**installing script**> srt_int_mkdir
<**installing script**> srt_int_querypkg
<**installing script**> srt_layer_init
<**installing script**> srt_layer_link
<**installing script**> srt_super_init
<**installing script**> statusrel


*** Create layer1a ***

|abacus>cd ..
|abacus>newrel --empty -p layer1a
Creating a frozen release "layer1a" in the directory
    /home/amundson/work/dist/releases
|abacus>cd layer1a
|abacus>srt_setup SRT_BASE_RELEASE=layer1a
|abacus>mkdir sublayers
|abacus>cd sublayers
|abacus>ln -s ../../layer0 .
|abacus>cd ..
|abacus>srt_layer_init
|abacus>addpkg --production --head BinExamples
Adding package "BinExamples" to "/home/amundson/work/dist/releases/layer1a".
|abacus>gmake
<**codegen**>
<**codegen**> BinExamples
<**include**>
<**include**> BinExamples
<**lib**>
<**lib**> BinExamples
<**bin**>
<**bin**> BinExamples
<**compiling**> SimpleBinExample.cc
<**building**> SimpleBinExample
<**compiling**> SimpleBinExample2.cc
<**building**> SimpleBinExample2
<**installing script**> ScriptExample
<**compiling**> ComplexBinBonjour.cc
<**compiling**> ComplexBinGutenTag.cc
<**compiling**> ComplexBinMain.cc
<**building**> ComplexBinExample


*** Create layer1b ***

|abacus>cd ..
|abacus>newrel --empty -p layer1b
Creating a frozen release "layer1b" in the directory
    /home/amundson/work/dist/releases
|abacus>cd layer1b
|abacus>srt_setup SRT_BASE_RELEASE=layer1b
|abacus>mkdir sublayers
|abacus>cd sublayers
|abacus>ln -s ../../layer0 .
|abacus>cd ..
|abacus>addpkg --production --head UsesSubpackages
Adding package "UsesSubpackages" to "/home/amundson/work/dist/releases/layer1b".|abacus>srt_layer_init
|abacus>gmake
<**codegen**>
<**codegen**> UsesSubpackages
<**include**>
<**include**> UsesSubpackages
<**lib**>
<**lib**> UsesSubpackages
<**compiling**> Hello.cc
<**building library**> libSubmarinePkg
<**compiling**> Hello.cc
<**building library**> libSubzeroPkg
<**bin**>
<**bin**> UsesSubpackages
<**compiling**> UsesSubpackagesExample.cc
<**building**> UsesSubpackagesExample
<**compiling**> JustPlainHello.cc
<**building**> JustPlainHello

*** Create layer2 ***

|abacus>cd ..
|abacus>newrel --empty -p layer2 
Creating a frozen release "layer2" in the directory
    /home/amundson/work/dist/releases
|abacus>cd layer2
|abacus>mkdir sublayers
|abacus>cd sublayers
|abacus>ln -s ../../layer1a .
|abacus>ln -s ../../layer1b .
|abacus>cd ..
|abacus>srt_layer_init
|abacus>srt_setup SRT_BASE_RELEASE=layer2 
|abacus>addpkg --production --head UsesCodegen
Adding package "UsesCodegen" to "/home/amundson/work/dist/releases/layer2".
|abacus>gmake
<**codegen**>
<**codegen**> UsesCodegen
<**generating**> /home/amundson/work/dist/releases/layer2/tmp/Linux2-KCC_3_3/UsesCodegen/genfile.cc
<**include**>
<**include**> UsesCodegen
<**lib**>
<**lib**> UsesCodegen
<**compiling**> GenHello.cc
<**compiling**> genfile.cc
<**building library**> libGenHello
<**bin**>
<**bin**> UsesCodegen
<**compiling**> CodeGenExample.cc
<**building**> CodeGenExample

